{{define "title"}}Admin · Edit User · lumgr{{end}}
{{define "content"}}
<div class="grid two">
    <div class="card">
        <h2 style="margin:0 0 8px;">Edit Groups: {{.EditUser.Name}}</h2>
        <div class="muted" style="margin-bottom: 12px;">Manage group memberships.</div>

        <form method="post" action="/admin/users/update_groups">
            <input type="hidden" name="username" value="{{.EditUser.Name}}" />

            <div style="margin-bottom: 16px;">
                <label>Groups</label>
                <div class="muted" style="margin-bottom: 8px; font-size: 13px;">
                    Select the groups this user should belong to.
                </div>

                <div
                    style="display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                    {{range .FeaturedGroups}}
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="g_{{.}}" name="groups" value="{{.}}"
                            style="width: 16px; height: 16px; flex: 0 0 16px; margin: 0;" {{if (contains
                            $.EditUser.Groups .)}}checked{{end}} />
                        <label for="g_{{.}}" style="margin:0; cursor: pointer; flex: 1; display: block;">{{.}}</label>
                    </div>
                    {{end}}

                    {{if .OtherGroups}}
                    <details style="margin-top: 5px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px;">
                        <summary style="cursor: pointer; font-size: 13px; color: var(--muted); padding: 5px 0;">Show
                            other groups ({{len .OtherGroups}})</summary>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 5px;">
                            {{range .OtherGroups}}
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="g_{{.}}" name="groups" value="{{.}}"
                                    style="width: 16px; height: 16px; flex: 0 0 16px; margin: 0;" {{if (contains
                                    $.EditUser.Groups .)}}checked{{end}} />
                                <label for="g_{{.}}"
                                    style="margin:0; cursor: pointer; flex: 1; display: block;">{{.}}</label>
                            </div>
                            {{end}}
                        </div>
                    </details>
                    {{end}}
                </div>
            </div>

            <div style="display:flex; justify-content:flex-end; margin-top: 14px;">
                <button class="btn primary small" type="submit">Save Join</button>
            </div>
        </form>
    </div>

    <div class="card">
        <h2 style="margin:0 0 8px;">File Permissions</h2>
        <div class="muted" style="margin-bottom: 12px;">Recursively apply chmod to user's home (skips .ssh).</div>

        <form method="post" action="/admin/users/chmod">
            <input type="hidden" name="username" value="{{.EditUser.Name}}" />

            <table
                style="width: 100%; border-collapse: collapse; margin-bottom: 16px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                <thead>
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <th style="text-align: left; padding: 8px;">Scope</th>
                        <th style="text-align: center; padding: 8px;">R</th>
                        <th style="text-align: center; padding: 8px;">W</th>
                        <th style="text-align: center; padding: 8px;">X</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="padding: 8px;">User (Owner)</td>
                        <td style="text-align: center;"><input type="checkbox" name="ur" value="1" checked
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                        <td style="text-align: center;"><input type="checkbox" name="uw" value="1" checked
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                        <td style="text-align: center;"><input type="checkbox" name="ux" value="1" checked
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Group</td>
                        <td style="text-align: center;"><input type="checkbox" name="gr" value="1"
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                        <td style="text-align: center;"><input type="checkbox" name="gw" value="1"
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                        <td style="text-align: center;"><input type="checkbox" name="gx" value="1"
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                    </tr>
                    <tr>
                        <td style="padding: 8px;">Other</td>
                        <td style="text-align: center;"><input type="checkbox" name="or" value="1"
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                        <td style="text-align: center;"><input type="checkbox" name="ow" value="1"
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                        <td style="text-align: center;"><input type="checkbox" name="ox" value="1"
                                style="width:16px; height:16px; margin:0 auto; display:block;" /></td>
                    </tr>
                </tbody>
            </table>

            <div style="margin-bottom: 16px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="sgid" name="setgid" value="1"
                        style="width:16px; height:16px; margin:0; flex: 0 0 16px;" />
                    <label for="sgid" style="margin:0; cursor: pointer; display: block;">Enable setgid on directories
                        (g+s)</label>
                </div>
            </div>

            <div style="display:flex; justify-content:space-between; margin-top: 14px;">
                <a href="/admin/users" class="btn ghost">Back</a>
                <button class="btn danger small" type="submit">Apply Recursive Chmod</button>
            </div>
        </form>
    </div>
</div>
{{end}}